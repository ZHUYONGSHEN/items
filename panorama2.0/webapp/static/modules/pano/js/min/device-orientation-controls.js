/**
 * @author richt / http://richt.me
 * @author WestLangley / http://github.com/WestLangley
 *
 * W3C Device Orientation control (http://w3c.github.io/deviceorientation/spec-source-orientation.html)
 */
THREE.DeviceOrientationControls=function(e,t,n){function i(e,t){return function(){t.apply(e,arguments)}}this.object=t,this.object.rotation.reorder("YXZ"),this.mesh=n,this.pano=e,this.rotateMesh=!0,this.freeze=!0,this.deviceOrientation={},this.offsetMesh={},this.screenOrientation=0,this.orient=null,this.supportDeviceOrientation="onorientationchange"in window;var o=this;this.onDeviceOrientationChangeEvent=function(e){this.deviceOrientation=e},this.onScreenOrientationChangeEvent=function(){this.screenOrientation=window.orientation||0},this.adjustMesh=function(e){this.rotateMesh=e},this.resetAngle=function(){this.offsetMesh={}},this.pause=function(){this.freeze_tmp=!0},this.play=function(){this.freeze_tmp=!1,this.resetAngle()},this.update=function(){var e,t,n,i;return function(){this.freeze||this.freeze_tmp||$.isEmptyObject(this.deviceOrientation)||(e=this.deviceOrientation.alpha?THREE.Math.degToRad(this.deviceOrientation.alpha):0,t=this.deviceOrientation.beta?THREE.Math.degToRad(this.deviceOrientation.beta):0,n=this.deviceOrientation.gamma?THREE.Math.degToRad(this.deviceOrientation.gamma):0,i=this.screenOrientation?THREE.Math.degToRad(this.screenOrientation):0,r(e,t,n,i))}}(),this.connect=function(){this.onScreenOrientationChangeEvent(),window.addEventListener("orientationchange",i(this,this.onScreenOrientationChangeEvent),!1),window.addEventListener("resize",i(this,this.onScreenOrientationChangeEvent),!1),window.addEventListener("deviceorientation",i(this,this.onDeviceOrientationChangeEvent),!1),this.resetAngle(),this.freeze=!1},this.disconnect=function(){if(this.freeze=!0,window.removeEventListener("orientationchange",i(this,this.onScreenOrientationChangeEvent),!1),window.removeEventListener("resize",i(this,this.onScreenOrientationChangeEvent),!1),window.removeEventListener("deviceorientation",i(this,this.onDeviceOrientationChangeEvent),!1),o.object){var e=o.object.quaternion.clone(),t=new THREE.Euler;t.setFromQuaternion(e,"YXZ"),t.z=0,e.setFromEuler(t),o.object.quaternion.copy(e)}};var r=function(){var t=new THREE.Vector3(0,0,1),n=new THREE.Euler,i=new THREE.Quaternion,r=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),s=new THREE.Quaternion;return function(a,h,c,E){n.set(h,a,-c,"YXZ"),s.setFromEuler(n),s.multiply(r),s.multiply(i.setFromAxisAngle(t,-E)),!$.isEmptyObject(o.offsetMesh)||o.rotateMesh!==!0&&o.supportDeviceOrientation===!0?($.isEmptyObject(o.offsetMesh)||(s=o.offsetMesh.clone().multiply(s)),o.object.quaternion.copy(s),e.bIsChanged=!0):(o.object.updateMatrixWorld(),o.offsetMesh=o.object.quaternion.clone().multiply(s.conjugate()))}}()};