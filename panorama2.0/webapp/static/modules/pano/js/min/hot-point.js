function regPointEvent(n){}function onPosChanged(n){var t=n;return function(){var n=this.position();t.x=n.x,t.y=n.y,t.z=n.z}}function createPointImg(n,t,e,o){var a=document.createElement("div"),i=$("#container"),r=i.offset(),d=n.tag.res_id,c=$("<img crossorigin='Anonymous' />");c.appendTo(a),c.attr({src:d}),$(a).addClass("hot-point-tag-item"),$(a).appendTo($("#container")),$(a).attr({"data-index":e,draggable:!1});var p=r.top+i.height()/2,s=r.left+i.width()/2;if($(a).offset({top:p,left:s}),n.tag.name&&""!==n.tag.name&&n.tag.titleShow){var l=$.parseHTML('<div class="point-title-div"><p></p></div>');$("p:first",$(l)).html(n.tag.name),$(l).appendTo($(a)),$(l).offset({left:s+($(a).width()-$(l).width())/2})}var m=o.addPointItem(a,n.tag.point,"display","jump"==n.type);return n.tag.point?m.pos=n.tag.point:n.tag.point=m.position(),t&&($(a).css({opacity:.5}),m.onPosChanged=onPosChanged(n.tag.point)),n.secen_item=m,n.div_item=a,a}function loadAllPoint(n){return myPano=n,function(){var t=n.currScenePointMap;for(var e in t)if(0!=t.hasOwnProperty(e)){var o=t[e],a=createPointImg(o,n.isScenesEdit,e,n);o.div_item=a}}}function getImageRelativeSize(n,t,e,o){return(n>e||t>o)&&(n/t>e/o?(t=e*t/n,n=e):(n=o*n/t,t=o)),{w:n,h:t}}function showPictureModal(n){var t=n.tag.other_res_id;if(t){var e=$("#display-point-info-mdl");e.empty();var o=new Image;o.crossOrigin="Anonymous",o.src=t,o.onload=function(n){var t=n||window.event,o=t.target,a=document.documentElement.clientWidth,i=document.documentElement.clientHeight,r=getImageRelativeSize(o.width,o.height,a-MAX_H_MARGIN,i-MAX_H_MARGIN);o.width=r.w,o.height=r.h,$(o).css({"margin-left":(a-r.w)/2,"margin-top":MAX_V_MARGIN}),e.append(o),e.append('<div class="display-point-info-close"></div>'),e.modal()}}}function showIntroduceModal(n){var t=n.tag.name,e=n.tag.content,o=$("#display-point-info-mdl");o.empty();var a=$.parseHTML('<div class="introduce-info-container"><h1>'+t+"</h1><p>"+e+"</p></div>");document.documentElement.clientWidth,document.documentElement.clientHeight;o.append(a),o.append('<div class="display-point-info-close"></div>'),o.modal()}function animateJumpFunc(n){function t(n){var o=myPano.camera.fov;if(o==c&&m>=1){myPano.overLooking=!1,myPano.controls.play(),myPano.loadScene(e);var a=myPano.project.scenes[e],d=myPano.project.groupsIndexMap[a.sceneGroup.id];return void $(".scene_group_desc").eq(d).trigger("click")}if(m<1){var u=30;if(s&&Math.abs((r-myPano.lon)%360/s)>n){var g=new THREE.Quaternion;g.setFromAxisAngle(new THREE.Vector3(0,1,0),THREE.Math.degToRad(s*n)),myPano.camera.quaternion.multiply(g)}if(l&&Math.abs((i-myPano.lat)/l)>n){var y=new THREE.Quaternion;y.setFromAxisAngle(new THREE.Vector3(1,0,0),THREE.Math.degToRad(l*n)),myPano.camera.quaternion.multiply(y)}m+=n,m>=1&&(u=600,n=.01,m=1),window.setTimeout(t,u,n+.005)}else o!=c&&(o-=n*p,o<c&&(o=c),myPano.camera.fov=o,window.setTimeout(t,30,n+.005));myPano.bIsChanged=!0,myPano.camera.updateProjectionMatrix()}var e=myPano.getSceneIndex(n.tag.scene_id);if(null!==e&&!myPano.overLooking){myPano.overLooking=!0;var o=n.secen_item.position(),a=window.xyz2latlon(o.x,o.y,o.z,500),i=a.lat,r=a.lon,d=myPano.getCurrScene().visual_angle,c=d.minFov?d.minFov:20,p=myPano.camera.fov-c,s=(r-myPano.lon)%360;s>180?(r-=360,s-=360):s<-180&&(r+=360,s+=360);s=Math.round(100*s)/100;var l=Math.round(100*(i-myPano.lat))/100,m=0;myPano.controls.pause(),t(.04)}}function baseModle(n){var t=$("#display-point-info-mdl");t.empty();var e=(document.documentElement.clientWidth,document.documentElement.clientHeight,$("<div></div>").append(n).addClass("mdl-content"));t.append('<div class="display-point-info-close"></div>'),t.append(e),t.modal("show")}var myPano=null,MAX_H_MARGIN=200,MAX_V_MARGIN=100;SLCUtility.browser.versions.mobile&&(MAX_H_MARGIN=20,MAX_V_MARGIN=80),$("#container").on("click",".hot-point-tag-item",function(n){if(!myPano.isScenesEdit){var t=$(n.target);0==t.hasClass("hot-point-tag-item")&&(t=t.parent(".hot-point-tag-item"));var e=t.attr("data-index"),o=myPano.currScenePointMap,a=o[e];if(void 0!==a)if("jump"==a.type)animateJumpFunc(a);else if("hyperlink"==a.type)a.tag.new_target?parent.window.open(a.tag.link_url):parent.window.location.href=a.tag.link_url;else if("voice"==a.type){var i=a.tag.other_res_id;if(!i)return;var r=$("#background_music")[0];r&&!r.paused&&(r.pause(),$(".music")&&$(".music").css({"background-image":"url("+cdn_url+linkerData.linkerLeftButton.yyStopIcon+")"})),audio_project&&!audio_project.paused&&(audio_project.pause(),$(".gopng_sound")&&$(".gopng_sound").css({"background-image":"url("+cdn_url+linkerData.linkerRightButton.yyStopIcon+")"})),audio_point.src==i?audio_point.paused?audio_point.play():audio_point.pause():(audio_point.src=i,audio_point.play())}else"picture"==a.type?showPictureModal(a):"introduce"==a.type&&showIntroduceModal(a)}}),$("#display-point-info-mdl").on("click",".display-point-info-close",function(n){$("#display-point-info-mdl").modal("hide").empty()});