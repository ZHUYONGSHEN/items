var HOST_URL,globalVar=!1,custom_bottom_bar;!function(){function e(e,t){e||console.log(t)}function t(e,t,n,i,r){void 0===i&&(i={x:0,y:0,z:0}),this.nSceneId=t,this.parent=e,this.elem=n,this.pos=i,this.mode=r,this.onDrag=!1,this.mousedown=null,this.dirty=!0,$(this.elem).appendTo(".leftContainer","#"+e.containerId),"edit"===r&&o(this)}function n(e,t,n,o){var i,r,s=n,a=function(t){e.releaseCapture?(e.releaseCapture(),e.removeEventListener("mouseup",a),e.removeEventListener("mousemove",s)):(window.onmousemove=i,window.onmouseup=r),o(t)},c=function(n){e.setCapture?(e.setCapture(),e.addEventListener("mouseup",a),e.addEventListener("mousemove",s)):(window.captureEvents(Event.MOUSEMOVE|Event.MOUSEUP),i=window.onmousemove,r=window.onmouseup,window.onmousemove=s,window.onmouseup=a),t(n)};return e.addEventListener("mousedown",c),c}function o(e){var t,o,i,r,s=e.elem,a=e.parent,c=function(n){"edit"==e.mode&&(e.onDrag=!0,e.dirty=!0,t=$(s).offset().left,o=$(s).offset().top,i=n.pageX,r=n.pageY,n.preventDefault())},l=function(n){"edit"==e.mode&&(void 0!==n.pageX&&void 0!==n.pageY?$(s).offset({left:t+n.pageX-i,top:o+n.pageY-r}):void 0!==n.distanceX&&void 0!==n.distanceY&&$(s).offset({left:t+n.distanceX,top:o+n.distanceY}),e.dirty=!0,n.preventDefault())},d=function(t){if("edit"==e.mode){e.onDrag=!1,e.dirty=!0;var n=$(s).position().left+$(s).width()/2,o=$(s).position().top+$(s).height()/2,i=a.vec2ToVec3({x:n,y:o});e.pos={x:i.x,y:i.y,z:i.z},e.onPosChanged&&e.onPosChanged(),t.preventDefault()}};q.isPc?e.mousedown=n(s,c,l,d):(touch.on(s,"dragstart",c),touch.on(s,"drag",l),touch.on(s,"dragend",d),touch.on(s,"touchstart",function(e){e.preventDefault()}))}function i(e,t,n,o,i,r){function s(h){if(h&&(null!==n&&(n.stop(),n=null),$("#pageSpinner").remove(),r.overLooking===!0?d=h:(d=null,e.image=h,e.image.crossOrigin="Anonymous",e.needsUpdate=!0),l=!0,r.bIsChanged=!0,++V,C(r,o[a-1].oorigin_id,o[a-1].access_url,V)),a<i){t.setCrossOrigin("Anonymous");var u=o[a++],m=14,v=9,p=u.access_url;if(r.likeNum=u.likeNum,navigator.userAgent.indexOf("Mobile")>0){var g=navigator.userAgent.indexOf("CPU iPhone OS "),f=g+m,b=navigator.userAgent.indexOf("_"),_=navigator.userAgent.substring(f,b),w=p.match(/\.\d+\./g);w=w[0].replace(".",""),w=w.replace(".",""),w>2048&&(p=_<v?p.replace(/\.\d+\.\d+\d./g,".2048.1024."):p.replace(/\.\d+\.\d+\d./g,".4096.2048."))}t.load(p,s)}0==r.overLooking&&(d&&(e.image=d,e.image.crossOrigin="Anonymous",e.needsUpdate=!0,d=null,r.bIsChanged=!0),l&&c&&(c=!1,r.SendFilishEvent()))}var a=0,c=!0,l=!1,d=null;return s(),s}function r(e,t,n){var o=ResourceMgr.find(t),r={width:SLCUtility.webgl.params.MAX_TEXTURE_SIZE,height:SLCUtility.webgl.params.MAX_TEXTURE_SIZE},s=spinnerOpts();s.color="#cccccc",$("#pageSpinner").remove();var a=$('<div id="pageSpinner"><div id="page-spinner-copy">数据加载中..</div></div>');$("#"+e).closest("DIV").append(a);var c=new Spinner(s).spin(a.get(0));n.texture=new THREE.Texture,n.geometry=new THREE.SphereGeometry(500,60,40),n.material=new THREE.MeshBasicMaterial({map:n.texture}),n.geometry.scale(-1,1,1);var l=new THREE.ImageLoader;l.setCrossOrigin("Anonymous");for(var d=0;d<o.length&&!(cmpPictureSize(r,getPicfileSize(o[d]))<0);d++);return D=i(n.texture,l,c,o,d,n),new THREE.Mesh(n.geometry,n.material)}function s(e,t,n){var o=THREE.Math.degToRad(90-e),i=THREE.Math.degToRad(t),r={};return r.x=n*Math.sin(o)*Math.sin(i),r.y=n*Math.cos(o),r.z=n*Math.sin(o)*Math.cos(i),r}function a(e,t,n,o){var i=Math.atan2(e,n);i<0&&(i+=2*Math.PI);var r,s,a={},c=Math.sqrt(e*e+n*n);if(0==c)a.lat=t>0?89.9:-89.9;else{t/c>1?(r=t/c,s=r/(r+1)):t/c<-1?(r=t/c,s=-r/(r-1)):s=t/c;var l=Math.acos(s);a.lat=90-THREE.Math.radToDeg(l)}return a.lon=THREE.Math.radToDeg(i),a}function c(e){function t(t){var n=e.getCurrScene().visual_angle;initVisualAngle(n),e.lat=Math.max(n.min_angle,Math.min(n.max_angle,e.lat)),e.camera.fov=Math.max(n.min_fov,Math.min(n.max_fov,e.camera.fov))}function n(t){if($(".guide-wrap").fadeOut(),e.isUserInteracting=!0,e.controls.pause(),u=e.camera.quaternion.clone(),t.preventDefault(),null!=f){var n=window.cancelAnimationFrame||window.mozCancelAnimationFrame;n(f),f=null}}function o(n){if(e.isUserInteracting&&!e.overLooking){$("#point-title-div").hide(),n.preventDefault();var o=e.camera.fov/90,i=u.clone(),r=THREE.Math.degToRad(.2*n.distanceX)*o,s=new THREE.Euler;if(s.setFromQuaternion(i,"YXZ"),s.y=s.y+r,e.ready){var r=THREE.Math.degToRad(.2*n.distanceY)*o;s.x=s.x+r,s.x=Math.min(Math.PI/2,Math.max(-Math.PI/2,s.x))}i.setFromEuler(s),e.camera.quaternion.copy(i);var a=n.distanceX-m,c=n.distanceY-v;0!=a&&(p=a),0!=c&&(g=c),m=n.distanceX,v=n.distanceY,t(),e.bIsChanged=!0}}function i(n){function o(){if(c*=.8,e.bIsChanged=!0,c>.01&&null!==f){s+=l*c,a+=d*c;var n=u.clone(),h=THREE.Math.degToRad(.2*s)*e.camera.fov/90,m=new THREE.Euler;if(m.setFromQuaternion(n,"YXZ"),m.y=m.y+h,e.ready){var h=THREE.Math.degToRad(.2*a)*e.camera.fov/90;m.x=m.x+h,m.x=Math.min(Math.PI/2,Math.max(-Math.PI/2,m.x))}n.setFromEuler(m),e.camera.quaternion.copy(n),f=i(o)}else r(f),f=null,e.isUserInteracting=!1,e.controls.play(),t()}if(e.isUserInteracting){var i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,r=window.cancelAnimationFrame||window.mozCancelAnimationFrame,s=n.distanceX,a=n.distanceY;f=i(o);var c=.5,l=p,d=g}}function r(n){var o=window.event||n;e.vrMode!==!0&&(o.wheelDeltaY?e.camera.fov-=.05*o.wheelDeltaY:o.wheelDelta?e.camera.fov-=.05*o.wheelDelta:o.detail&&(e.camera.fov+=1*o.detail),t(),e.camera.updateProjectionMatrix(),e.bIsChanged=!0)}function s(t){d=e.camera.fov}function a(n){e.vrMode!==!0&&(e.camera.fov=d+75*(1-n.scale),t(),e.camera.updateProjectionMatrix(),e.bIsChanged=!0)}function c(t){d=e.camera.fov,e.bIsChanged=!0}function l(){e.bIsChanged=!0,e.camera.aspect=$(container).width()/$(container).height(),e.camera.updateProjectionMatrix(),e.renderer.setSize($(container).width(),$(container).height())}e.isUserInteracting=!1;var d=0,h=e.renderer.domElement,u={},m=0,v=0,p=0,g=0,f=null;h.addEventListener("mousewheel",r,!1),h.addEventListener("MozMousePixelScroll",r,!1),touch.on("#"+h.id,"dragstart",n),touch.on("#"+h.id,"drag",o),touch.on("#"+h.id,"dragend",i),touch.on("#"+h.id,"pinchstart",s),touch.on("#"+h.id,"pinchend",c),touch.on("#"+h.id,"pinch",a);var b={x:0,y:0},_=0;touch.on("#"+h.id,"touchstart",function(e){e.pageX&&e.pageY&&(b.x=e.pageX,b.Y=e.pageY),e.preventDefault()}),touch.on("#"+h.id,"touchmove",function(e){e.pageX&&e.pageY?(_+=Math.abs(e.pageX-b.x),_+=Math.abs(e.pageY-b.y)):_+=.5,e.preventDefault()}),touch.on("#"+h.id,"touchend",function(t){_<1&&(e.bIsChanged||$(".custom-bottom-bar .cutover").trigger("click")),_=0,t.preventDefault()}),window.addEventListener("resize",l,!1)}function l(e){this.containerId=e,this.camera=null,this.lat=0,this.lon=0,this.scene=null,this.renderer=null,this.vrRenderer=null,this.mesh=null,this.geometry=null,this.material=null,this.texture=null,this.scenePoints=[],this.project=null,this.nSceneIdx=null,this.externalItem=[],this.globalSceneItem=[],this.isAnimationRunning=!1,this.bIsChanged=!1,this.currScenePointMap=null,this.isScenesEdit=!1,this.loadFilishEvent=[],this.overLooking=!1,this.customSwitchScene=!0,this.vrMode=!1,this.sceneChangeFunc=[],this.bottom_geometry=null,this.bottom_material=null,this.bottom_texture=null,this.bottom_mesh=null,this.top_geometry=null,this.top_material=null,this.top_texture=null,this.top_mesh=null,this.bottom_logo_geometry=null,this.bottom_logo_material=null,this.bottom_logo_texture=null,this.bottom_logo_mesh=null,this.cosAccessHost=null,this.likeNum=null}function d(n){return n.fakeItem||(e("edit"!=n.mode,"edit"!=n.mode),n.fakeItem=new t(n.parent,n.nSceneId,n.elem.cloneNode(!0),n.pos,n.mode),n.fakeItem.elem.onclick=function(){return $(n.elem).trigger("click"),!1},n.fakeItem.dirty=!0,$(n.fakeItem.elem).appendTo(n.parent.rightContainer())),n.fakeItem}function h(){var e=$(".vr-size");"distance"==$(".select-left").data("property")&&(e=$(".vr-distance"));var t=e.offset().top;$(".setting-select").each(function(e,n){$(n).offset({top:t})})}function u(){var e=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;return!!e}function m(e,t){function n(e){return function(){$(".select-left").data("property",$(e).data("property")),$(".select-right").data("property",$(e).data("property")),h()}}function o(e){var t=100*e;$(".vr-distance .item-desc").text(t.toFixed(2)+" mm")}function i(e){$(".vr-size .item-desc").text(e+" inch")}function r(e){var n=0;e>0?n+=.001:n-=.001;var o=t.vrRenderer.getEyeSep();return o+=n,o=t.vrRenderer.updateEyeSep(o)}function s(e,n){var s;switch(e){case"distance":s=r(n),o(s);break;case"size":s=t.vrRenderer.getScreen()+.1*n,s=Math.round(10*s)/10,t.vrRenderer.setScreen(s),i(s)}}function a(){s($(".select-left").data("property"),-1)}function c(){s($(".select-right").data("property"),1)}function l(e,t){return function(){return e(),f&&clearInterval(f),f=setInterval(e,t),!1}}function d(){f&&clearInterval(f)}var m=$(".vr-setting-pane",e);if(0===m.length){m=$(X).appendTo(e);var v=detectInfo();$(".device-name .item-desc").text(v.device.name),o(t.vrRenderer.getEyeSep()),i(t.vrRenderer.getScreen());var f;q.isPc?($(".select-left").bind("mousedown",l(a,200)),$(".select-right").bind("mousedown",l(c,200)),$(".select-left").bind("mouseup",d),$(".select-right").bind("mouseup",d)):(touch.on($(".select-left").get(0),"touchstart",l(a,200)),touch.on($(".select-right").get(0),"touchstart",l(c,200)),touch.on($(".select-left").get(0),"touchend",d),touch.on($(".select-right").get(0),"touchend",d)),$(".select-left").bind("mouseup",d),$(".select-right").bind("mouseup",d),$(".vr-size").bind("click",n($(".vr-size"))),$(".vr-distance").bind("click",n($(".vr-distance"))),$(".setting-close").bind("click",function(){g(m),m.hide()}),$(".setting-reset").bind("click",function(){t.vrRenderer.updateEyeSep(.064);var e=detectInfo();t.vrRenderer.setScreen(e.device.screen),o(t.vrRenderer.getEyeSep()),i(t.vrRenderer.getScreen())}),$(".vr-exit").bind("click",function(){g(m),m.hide(),$(".custom-bottom-bar").css("bottom","0px"),$(".custom-bottom-bar .switch_bar").is(".unfold")||$(".custom-bottom-bar .switch_bar").removeClass("collapsed").addClass("unfold"),$(".linkerButtonBelows").css({bottom:custom_bottom_bar+"px"}),u()?exitFullscreen():t.switchVRMode()}),$(".vr-config").bind("click",function(){return m.stop(!0,!1),m.show().animate({opacity:1},100),p(m),!1});var b=$(".vr-size").offset().top;$(".select-left").offset({top:b}),$(".select-right").offset({top:b}),$(".vr-setting").hide()}g(m),m.stop(!0,!1),m.show().animate({opacity:1},200).fadeOut(5e3)}function v(e){var t=$(".vr-setting-pane",e);if(0!==t.length)return t.hide()}function p(e){var t=$(".mask",e),n=$(".vr-setting",e);n.show(),t.show();var o=e.offset().left+e.width()/2;$(".item-name",n).each(function(e,t){$(t.parentNode).offset({left:o-$(t).width()-5})}),$(".select-left").offset({left:o-150}),$(".select-right").offset({left:o+150}),h()}function g(e){$(".vr-setting",e).hide(),$(".mask",e).hide()}function f(e){var t=detectInfo();e.setScreen(t.device.screen);var n=getCookie("eyeSep");n&&e.updateEyeSep(parseFloat(n));var o=getCookie("screen");o&&e.setScreen(parseFloat(o))}function b(e){var t=e.project.scene_groups;if(t&&t.length>0)return t;for(var n=[],o=0;o<e.project.scenes.length;o++)n.push(e.project.scenes[o].id);return[{title:"",scenes:n}]}function _(e,t){var n=b(e);if(!(t>=n.length)){var o=$(".group-bar","#"+e.containerId),i=$(".ul-imgs:first","#"+e.containerId);if(o.length>0){i.empty();var r,s,a,c='<li data-idx="{id}" title="{name}"><div><img draggable="false" class="unselectable" crossorigin ="Anonymous" src="{url}"><span class="scene-name unselectable">{name}</span></div></li>',l=e.project.scenes,d=n[t].scenes;if(d)for(var h=0,s=d.length;h<s;h++)a=sceneIdxById(d[h].id,l),a<0||(r=$(c.format({name:l[a].name,url:l[a].thumbnailUrl,id:a})),a===e.nSceneIdx&&r.addClass("li-select"),r.appendTo(i))}$(".scene_group_desc",o).removeClass("select").eq(t).addClass("select")}}function w(e,t,n){function o(e){var t=$(e).height();$(n).stop(!0,!1).animate({bottom:-t}).promise().then($(e).removeClass("unfold").addClass("collapsed"))}function i(e){$(n).stop(!0,!1).animate({bottom:0}).promise().then($(e).removeClass("collapsed").addClass("unfold"))}function r(t){if("IMG"!=t.target.tagName)return!1;var n=$(t.target).closest("li");if(0!==n.length){var o=n.data("idx");return e.nSceneIdx!==o&&(e.loadScene(o),L(o)),t.stopPropagation(),countUserAction(e.project.id,"click"),!0}return!1}function s(t){var n=$(t.target).closest(".scene_group_desc");return 0!==n.length&&(_(e,n.index()),u.css({left:0}),!0)}function a(e){return function(t){var n=0;t.wheelDeltaY?n-=t.wheelDeltaY/120:t.wheelDelta?n-=t.wheelDelta/120:t.detail&&(n+=t.detail/6),y(100*-n,e),t.stopPropagation()}}function c(){x=0}function l(e){return function(t){t.distanceX-=x,y(t.distanceX,e),x+=t.distanceX}}var d=$(".switch_bar","#"+e.containerId);0!==d.length&&d.remove(),d=$("<div class='switch_bar unfold'>            <div class='cutover'><span></span></div>                <div class='group-bar'></div>                   <div class='ul-box'>                    <ul class='ul-imgs'></ul></div></div>");for(var h=$(".ul-box:first",d),u=$(".ul-imgs:first",d),m=$(".group-bar",d),v=b(e),p='<div class="scene_group_desc"><div class="ul-point"></div> <p>{title}</p> </div>',g=!0,f=0;f<v.length;f++){var w;""!=v[f].title&&(w=p.format(v[f]),$(w).appendTo(m),g=!1)}g&&m.addClass("group-default-padding"),$(d).bind("click",function(e){if(!s(e))return r(e)?void(window.parent&&window.parent.postMessage(window.location.href,"*")):void 0}),$(".cutover",d).bind("click",function(e){d.hasClass("collapsed")?(i(d.get(0)),$(".linkerButtonBelows").stop(!0,!1).animate({bottom:custom_bottom_bar+"px"})):(o(d.get(0)),$(".linkerButtonBelows").stop(!0,!1).animate({bottom:"0px"}))}),d.appendTo($(n)),custom_bottom_bar=$(".custom-bottom-bar").height(),e.customSwitchScene||d.hide();var y=function(e,t){var n=h.width()-t.outerWidth(),o=0,i=Math.min(o,Math.max(n,t.position().left+e));t.css({left:i})},x=0;u.get(0).addEventListener("mousewheel",a(u),!1),touch.on(u.get(0),"dragstart",c),touch.on(u.get(0),"drag",l(u)),m.get(0).addEventListener("mousewheel",a(m),!1),touch.on(m.get(0),"dragstart",c),touch.on(m.get(0),"drag",l(m));var E=e.project.scenes[e.nSceneIdx],I=e.project.groupsIndexMap[E.sceneGroup.id];_(e,I)}function y(e,t){var n=e.externalItem[t];for(var o in n)$(n[o].elem).hide(),n[o].fakeItem&&$(n[o].fakeItem.elem).hide()}function x(e){for(var t=0;t<e.length;t++)$(e[t].elem).remove(),e[t].fakeItem&&$(e[t].fakeItem.elem).remove()}function E(e,t,n,o,i,r){var s={x:t.x-e.x,y:t.y-e.y,z:t.z-e.z},a={x:n.x-e.x,y:n.y-e.y,z:n.z-e.z};return!(s.x*a.x+s.y*a.y+s.z*a.z<0)}function I(e,t,n){function o(e){var t=new THREE.Vector3(0,0,-1);return t.applyMatrix4(e.matrixWorld),t}function i(e,t){$(e.elem).css({"-webkit-transform":"rotate("+t+"deg)","-moz-transform":"rotate("+t+"deg)","-ms-transform":"rotate("+t+"deg)","-o-transform":"rotate("+t+"deg)",transform:"rotate("+t+"deg)"}),e.fakeItem&&$(e.fakeItem.elem).css({"-webkit-transform":"rotate("+t+"deg)","-moz-transform":"rotate("+t+"deg)","-ms-transform":"rotate("+t+"deg)","-o-transform":"rotate("+t+"deg)",transform:"rotate("+t+"deg)"})}function r(t,n){n.dirty=!1;var i=$(n.elem),r=n.position(),s=t.target||o(t),a=new THREE.Vector3(r.x,r.y,r.z),c=e.vec3toVec2(t,a),l=i.data("width"),d=i.data("height");if("number"==typeof h&&"number"==typeof u||(l=i.width(),d=i.height(),i.data("width",l),i.data("height",d)),c.x-=l/2,c.y-=d/2,E(t.position,s,r,c,l,d)===!1)return i.hide(),!1;i.show();var h=i.data("left"),u=i.data("top"),m={left:h,top:u};if("number"==typeof h&&"number"==typeof u||(m=i.position()),Math.abs(m.left-c.x)>1||Math.abs(m.top-c.y)>1){i.offset();i.css({top:c.y,left:c.x}),i.data("left",c.x),i.data("top",c.y)}return i.hide().show(0),!0}if(void 0===t)return!1;for(var s=!1,a=0;a<t.length;a++){if(e.vrMode||e.project.enable_orientation){var c=horizontalRotateAngle();i(t[a],c)}else i(t[a],0);if("fix"!=t[a].mode&&!t[a].onDragStat()&&(n||t[a].dirty)&&!$(t[a].elem).hasClass("vr-hide")){var l=e.vrMode?e.vrRenderer.stereo.cameraL:e.camera;if(s|=r(l,t[a]),e.vrMode){e.getViewSize();s|=r(e.vrRenderer.stereo.cameraR,d(t[a]))}}}return s}function S(e){var t=e.project.scenes[e.nSceneIdx];if(t.bottomLogo){var n=e.cosAccessHost+t.bottomLogo,o=new THREE.ImageLoader;o.setCrossOrigin("Anonymous"),e.bottom_logo_texture=new THREE.Texture,e.bottom_logo_material=new THREE.MeshBasicMaterial({map:e.bottom_logo_texture}),e.bottom_logo_material.transparent=!0,o.load(n,function(t){e.bottom_logo_texture.image=t,e.bottom_logo_texture.image.crossOrigin="Anonymous",e.bottom_logo_texture.needsUpdate=!0;var n=Math.max(t.width,t.height);e.bottom_logo_geometry=new THREE.PlaneGeometry(250*t.width/n,250*t.height/n,25,25),e.bottom_logo_geometry.scale(-1,1,1),e.bottom_logo_mesh=new THREE.Mesh(e.bottom_logo_geometry,e.bottom_logo_material);var o=Math.sqrt(t.width*t.width+t.height*t.height)/2;o=Math.min(o,495),e.bottom_logo_mesh.position.y=Math.max(-Math.sqrt(25e4-o*o),-410),e.bottom_logo_mesh.rotation.x=Math.PI/2,e.scene.add(e.bottom_logo_mesh)})}}function M(e){return e.substring(e.lastIndexOf("."))}function C(e,t,n,o){var i=e.project.scenes[e.project.scenesIndexMap[t]],r=M(i.imgUrl),s=i.imgUrl+".bottom"+r;if(s){var a=new THREE.ImageLoader;a.setCrossOrigin("Anonymous"),e.bottom_texture=new THREE.Texture,e.bottom_material=new THREE.MeshBasicMaterial({map:e.bottom_texture}),e.bottom_material.transparent=!0,a.load(s,function(t){e.bottom_texture.image=t,e.bottom_texture.image.crossOrigin="Anonymous",e.bottom_texture.needsUpdate=!0;Math.max(t.width,t.height);e.bottom_geometry=new THREE.PlaneGeometry(420,420,25,25),e.bottom_geometry.scale(-1,1,1),e.scene.remove(e.bottom_mesh),e.bottom_mesh=new THREE.Mesh(e.bottom_geometry,e.bottom_material),e.bottom_mesh.position.y=-420,e.bottom_mesh.rotation.x=Math.PI/2,e.bottom_mesh.rotation.z=Math.PI/2,e.scene.add(e.bottom_mesh)})}var c=i.imgUrl+".top"+r;if(c){var a=new THREE.ImageLoader;a.setCrossOrigin("Anonymous"),e.top_texture=new THREE.Texture,e.top_material=new THREE.MeshBasicMaterial({map:e.top_texture}),e.top_material.transparent=!0,a.load(c,function(t){e.top_texture.image=t,e.top_texture.image.crossOrigin="Anonymous",e.top_texture.needsUpdate=!0;Math.max(t.width,t.height);e.top_geometry=new THREE.PlaneGeometry(420,420,25,25),e.top_geometry.scale(-1,1,1),e.scene.remove(e.top_mesh),e.top_mesh=new THREE.Mesh(e.top_geometry,e.top_material),e.top_mesh.position.y=420,e.top_mesh.rotation.x=-Math.PI/2,e.top_mesh.rotation.z=-Math.PI/2,e.scene.add(e.top_mesh)})}}function R(e,t){e.clearCurrScene();var n=e.renderer.getSize();e.camera=new THREE.PerspectiveCamera(75,n.width/n.height,1,1100),e.camera.focalLength=2;var o=e.getCurrScene().visual_angle;initVisualAngle(o);var i=o.init_point,s=i.x,c=i.y,l=i.z,d=a(s,c,l,500);e.lat=d.lat,e.lon=d.lon,e.camera.target=new THREE.Vector3(s,c,l),e.camera.lookAt(e.camera.target),e.bIsChanged=!0,0!==o.init_fov&&(e.camera.fov=o.init_fov),e.mesh=r(e.containerId,t,e),e.scene=new THREE.Scene,e.scene.add(e.mesh);var h=e.controls;e.controls=new THREE.DeviceOrientationControls(e,e.camera,e.mesh),h&&(e.controls.adjustMesh(h.rotateMesh),h.freeze||e.controls.connect(),h.freeze_tmp&&e.controls.pause()),S(e)}function T(e,t){function n(e,t,n){for(var o=0;o<t.length;o++){var i=SLCUtility.getHtmlId();e[i]={type:n,tag:t[o]}}}var o={};n(o,t.jump_tags,"jump"),n(o,t.hyperlink_tags,"hyperlink"),n(o,t.introduce_tags,"introduce"),n(o,t.picture_tags,"picture"),n(o,t.voice_tags,"voice"),n(o,t.mark_tags,"mark"),e.currScenePointMap=o}function k(e,t){function n(t,d){t<0&&(t=0);var h=t===l;h||(e.overLooking=!0),e.bIsChanged=!0;var u=h?1:t/500,m=new THREE.Quaternion;m.setFromAxisAngle(new THREE.Vector3(1,0,0),THREE.Math.degToRad(-90+(s+90)*(1-u)));var v=new THREE.Quaternion;if(v.setFromAxisAngle(new THREE.Vector3(0,1,0),THREE.Math.degToRad(r+180*u+180)),e.camera.quaternion.copy(v.multiply(m)),i.position.set(0,t,0),i.fov=a+(c-a)*u,i.updateProjectionMatrix(),t>0){var p=h?3e3:40;window.setTimeout(n,p,t-8,d)}else e.overLooking=!1,d(),o.hide(),D&&D()}var o=$("<div></div>");if($("#container").after(o),o.css({position:"absolute",top:0,right:0,bottom:0,left:0,"z-index":99999,width:"100vw",height:"100vh"}),e){var i=e.camera,r=e.lon,s=e.lat,a=e.getCurrScene().visual_angle.init_fov,c=e.getCurrScene().visual_angle.max_fov+20,l=500;n(l,t)}}function z(e){function t(){if(e.project.enable_autorotation===!0&&e.isUserInteracting!==!0&&e.overLooking!==!0&&e.ready&&e.isScenesEdit!==!0&&e.vrMode!==!0){var o=e.camera.quaternion.clone(),i=new THREE.Euler;i.setFromQuaternion(o,"YXZ"),i.y=i.y+THREE.Math.degToRad(-.05),e.camera.quaternion.setFromEuler(i),e.bIsChanged=!0}e.controls.update(),e.updateScene(),e.requestId=n(t)}var n=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,o=window.cancelAnimationFrame||window.mozCancelAnimationFrame;return null!==e.requestId&&o(e.requestId),e.renderer&&e.scene&&e.camera?(e.isAnimationRunning=!0,void t()):void(e.isAnimationRunning=!1)}function L(e,t){var n=$(".ul-imgs:first","#"+e.containerId);if(n.length>0){var o=$("li",n);$(".li-select",n).removeClass("li-select");for(var i=0;i<o.length;i++)o.eq(i).data("idx")==t&&o.eq(i).addClass("li-select")}}function A(e){if(e)for(var t=0;t<e.length;t++)e[t].dirty=!0}function P(e){var t=$('<div class="guide-wrap"><img class="guide"></img></div>').appendTo("#"+e.containerId);setTimeout(function(){t.fadeOut()},5e3)}function H(e){var t=$('<div class="custom-bottom-bar"></div>').appendTo("#"+e.containerId),n=detectInfo();n&&n.device&&"Mobile"==n.device.type&&t.addClass("phone"),w(e,e.project.scenes,t.get(0))}function j(e,t){var n=$(B);e.project.background_music;n.appendTo("#"+t),globalVar=!0;var o=detectInfo();o&&o.device&&"Mobile"==o.device.type&&n.addClass("phone"),U(e,n),O(e,n),F(e,n)}function F(e,t){e.project.enable_vr||$(".vr-switch",t).hide(),$(".vr-switch").click(function(){e.switchVRMode()})}function U(e,t){e.project.enable_orientation||$(".device-orientation",t).hide(),$(".device-orientation",t).click(function(){var n=$(this).hasClass("off");n?($(this).removeClass("off"),e.project.enable_autorotation&&$(".auto-rotation",t).trigger("click"),e.controls.connect()):($(this).addClass("off"),e.controls.disconnect()),e.project.enable_orientation=n,countUserAction(e.project.id,"click")})}function O(e,t){e.project.enable_autorotation||$(".auto-rotation",t).hide(),$(".auto-rotation",t).click(function(){var n=$(this).hasClass("off");n?($(this).removeClass("off"),e.project.enable_orientation&&$(".device-orientation",t).trigger("click")):$(this).addClass("off"),e.project.enable_autorotation=n,countUserAction(e.project.id,"click")}),e.project.enable_orientation&&$(".device-orientation",t).trigger("click"),e.project.enable_autorotation=!1}HOST_URL||(HOST_URL="");var q=function(){var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),n=/(?:SymbianOS)/.test(e)||t,o=/(?:Android)/.test(e),i=/(?:Firefox)/.test(e),r=(/(?:Chrome|CriOS)/.test(e),/(?:iPad|PlayBook)/.test(e)||o&&!/(?:Mobile)/.test(e)||i&&/(?:Tablet)/.test(e)),s=/(?:iPhone)/.test(e)&&!r,a=!s&&!o&&!n;return{isTablet:r,isPhone:s,isAndroid:o,isPc:a}}();t.prototype.onDragStat=function(){return this.onDrag},t.prototype.setMode=function(e){if(this.mode!=e){if("edit"===this.mode&&this.mousedown&&this.elem.removeEventListener("mousedown",this.mousedown),"fix"===this.mode){var t=this.parent,n=$(this.elem).offset(),i=this.pos=t.vec2ToVec3({x:n.left+$(this.elem).width()/2,y:n.top+$(this.elem).height()/2});i&&(this.pos={x:i.x,y:i.y,z:i.z})}"edit"===e&&o(this),this.mode=e,this.dirty=!0}},t.prototype.position=function(){return this.pos},t.prototype.info=function(){return{nSceneId:this.nSceneId,position:this.pos}},t.prototype.gotoItem=function(){var e=this.parent,t=a(this.pos.x,this.pos.y,this.pos.z,500);e.lat=t.lat,e.lon=t.lon,e.bIsChanged=!0};var D=null,V=0;l.prototype.AddLoadFilishEvent=function(e){this.loadFilishEvent.push(e)},l.prototype.SendFilishEvent=function(e){if(e||(e=this),e.ready)for(var t=0;t<e.loadFilishEvent.length;t++)e.loadFilishEvent[t]();else setTimeout(e.SendFilishEvent,300,e)},l.prototype.setCustomSwitchScene=function(e){this.customSwitchScene=e,e?$(".switch_bar","#"+this.containerId).show():$(".switch_bar","#"+this.containerId).hide()},l.prototype.vec2ToVec3=function(e){var t=new THREE.Vector2,n=new THREE.Raycaster,o=this.renderer.getSize();t.x=e.x/o.width*2-1,t.y=2*-(e.y/o.height)+1,n.setFromCamera(t,this.camera);var i=n.intersectObject(this.mesh);return i.length>0?i[0].point:{x:0,y:-500,z:0}},l.prototype.getViewSize=function(){var e=this.renderer.getSize();return this.vrMode&&(e.width/=2),e},l.prototype.vec3toVec2=function(e,t){var n=t.clone(),o=n.project(e),i=this.getViewSize(),r=i.width/2,s=i.height/2,a={x:Math.round(o.x*r+r),y:Math.round(-o.y*s+s)};return a},l.prototype.leftContainer=function(){var e=$(".leftContainer","#"+this.containerId);return e},l.prototype.rightContainer=function(){var e=$(".rightContainer","#"+this.containerId);return e};var X='<div class="vr-setting-pane vr-show">        <div class="vr-exit settting-desc">退出全屏</div>        <div class="mask"> </div>    <div class="vr-setting">    <div class="setting-item device-name">              <p class="settting-desc item-name floatLeft">设备:</p>                <p class="settting-desc item-desc" style="both">Unknown</p>        </div>      <div class="setting-item vr-size" data-property="size">                  <p class="settting-desc item-name floatLeft">屏幕尺寸:</p>                  <p class="settting-desc item-desc" style="clear:left">5.0 inch</p>       </div>      <div class="setting-item vr-distance" data-property="distance">                  <p class="settting-desc item-name floatLeft">瞳距:</p>                    <p class="settting-desc item-desc ">63.3 mm</p>        </div>      <div class="setting-select select-left" data-property="size">           <div class="setting-desc-item">                 <div class="settting-desc">&lt;</div>            </div>      </div>      <div class="setting-select select-right" data-property="size">           <div class="setting-desc-item">                 <div class="settting-desc ">&gt;</div>            </div>      </div>          <div class="settting-decide">          <p class="setting-reset settting-desc floatLeft">重置</p>                         <p class="setting-close settting-desc floatLeft">关闭</p>                     </div>      </div>      <div class="vr-config settting-desc">参数设置</div>     </div>';l.prototype.switchVRMode=function(){var e;return function(){function t(e){i.vrMode===!0&&m(o,i)}function n(){var e=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;e||(i.switchVRMode(),document.removeEventListener("fullscreenchange",n),document.removeEventListener("webkitfullscreenchange",n),document.removeEventListener("mozfullscreenchange",n),document.removeEventListener("MSFullscreenChange",n))}var o=$("#"+this.containerId),i=this,r=i.renderer.domElement;this.vrMode===!0?(this.vrRenderer&&this.vrRenderer.clear(this.camera),this.vrMode=!1,o.removeClass("vrMode"),this.leftContainer().children().removeClass("vr-hide"),o.children().removeClass("vr-hide"),v(o),e&&($(r).unbind("click",e),touch.unbind(r,"tap",e)),this.controls.disconnect(),this.controls.adjustMesh(!0)):(this.renderer.clear(),this.vrRenderer||(this.vrRenderer=new THREE.StereoEffect(this.renderer),f(this.vrRenderer)),this.vrMode=!0,o.addClass("vrMode"),m(o,this),this.leftContainer().children().not(".vr-show").addClass("vr-hide"),o.children().not("canvas").not(".vr-show").addClass("vr-hide"),enterFullscreen(o.get(0)),e=t,$(r).bind("click",e),touch.bind(r,"tap",e),document.addEventListener("fullscreenchange",n),document.addEventListener("webkitfullscreenchange",n),document.addEventListener("mozfullscreenchange",n),document.addEventListener("MSFullscreenChange",n),this.controls.connect(),this.controls.resetAngle(),this.controls.adjustMesh(!1)),this.bIsChanged=!0,this.updateScene()}}(),l.prototype.reloadProject=function(e){var t,n;$.ajax({type:"post",data:JSON.stringify({ids:[e],decode_res:!0}),url:HOST_URL+"/api/getProject",success:function(e){0===e.err_code&&(t=e.data.projects[0],n=e.data.resources[0])},async:!1}),this.reset(t,n),this.run()},l.prototype.convertData=function(e){var t=e.album;this.cosAccessHost=e.cosAccessHost;var n={};n.id=t.id,n.title=t.name,n.enable_autorotation=!0,n.enable_like=!1,n.enable_orientation=!0,n.enable_overlook=!1,n.enable_vr=!0,n.background_music={title:"",res_id:""},n.sand_table={points:[],res_id:""};for(var o=[],i={},r={},s=0,a=[],c={},l=0;l<t.sceneGroupList.length;l++){var d=t.sceneGroupList[l];if(r[d.id]=l,d.sceneList)for(var h=0;h<d.sceneList.length;h++){var u=d.sceneList[h];u.imgUrl=this.cosAccessHost+u.imgUrl,u.thumbnailUrl=this.cosAccessHost+u.thumbnailUrl,o.push(u),i[u.id]=s,s++;var m={id:u.id,access_url:u.imgUrl,oorigin_id:u.id,likeNum:u.likeNum};m.file_type="image/"+m.access_url.substring(m.access_url.lastIndexOf(".")+1),c[m.oorigin_id]=[m]}a[l]={title:d.name,scenes:d.sceneList}}this.resources=c,n.scenes=o,n.scenesIndexMap=i,n.groupsIndexMap=r,n.scene_groups=a,this.project=n},l.prototype.reset=function(e){if(e.album?this.convertData(e):(this.project=e.project,this.cosAccessHost=e.cosAccessHost,this.resources=e.project.resources),this.clearCurrScene(),ResourceMgr.update(this.resources),null===this.renderer){var t=document.getElementById(this.containerId);t.style.overflow="hidden",t.style.position="relative";var n="<div class='anchor vr-show'><div><div class='circle'></div><p class='glyphicon glyphicon-screenshot anchorshot' ></p></div></div>",o=$(".left",$(t));0===o.length&&(o=$("<div class='leftContainer vr-show'><div>"),o.appendTo($(t)),$(n).appendTo(o));var i=$(".right",$(t));0===i.length&&(i=$("<div class='rightContainer vr-show'><div>"),i.appendTo($(t)),$(n).appendTo(i)),this.renderer=new THREE.WebGLRenderer({preserveDrawingBuffer:!0,antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize($(t).width(),$(t).height()),this.renderer.domElement.id=this.containerId+"_canvas",t.appendChild(this.renderer.domElement),c(this)}var r=$("#"+this.containerId);$(".custom-btn-preview-mdl",r).remove(),$(".custom-link-btns",r).remove(),$(".custom-btns",r).remove(),$(".custom-btn-preview-mdl",r).remove(),$(".corner-deck",r).remove()},l.prototype.updateSandtable=function(){if(this.spv){var e=this.lon-this.init_lon,t=this.spv.init_degree-e;t%=360,t=t<0?t+360:t,this.spv.css("transform","rotate("+t+"deg)")}},l.prototype.registScenechange=function(e){this.sceneChangeFunc.push(e)},l.prototype.unregistScenechange=function(e){for(var t=0;t<this.sceneChangeFunc.length;t++)if(this.sceneChangeFunc[t]==e)return void this.splice(t,1)};var Y=function(){function e(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)+(e.z-t.z)*(e.z-t.z))}function t(e,t){var n=$(".anchor","#"+e.containerId);t?n.each(function(e,n){$(n).addClass("focus");var o=$(".circle",n).data("circle-progress");if($(n).data("target",t.elem),o)o.draw();else{var i=0;$(".circle",n).circleProgress({value:1,size:36,animation:{duration:5e3},fill:{color:"rgba(255, 255, 255, 1)"},emptyFill:"rgba(0, 0, 0, .0)"}).on("circle-animation-progress",function(e,t){i=t}).on("circle-animation-end",function(t){if(0===e&&Math.abs(i-1)<.001){var o=$(n).data("target");$(o).trigger("click")}})}}):n.each(function(e,t){$(t).removeClass("focus"),$(".circle",t).circleProgress("clear"),$(t).data("target",null)})}function n(e,t){var n=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),o=t/n;return{x:e.x*o,y:e.y*o,z:e.z*o}}var o=null;return function(i,r){if(r){for(var s,a=n(i.camera.target,500),c=1/0,l=0;l<r.length;l++){var d=r[l];if(!$(d.elem).is(":hidden")){var h=d.position(),u=e(h,a);u<50&&u<c&&(s=d)}}s!=o&&(o=s,t(i,o))}}}();l.prototype.updateScene=function(){var e=this.bIsChanged;
if(this.vrMode===!0&&this.vrRenderer?this.vrRenderer.render(this.scene,this.camera):this.renderer.render(this.scene,this.camera),this.bIsChanged){this.bIsChanged=!1;var t=this.camera.getWorldDirection();this.camera.target=t;var n=a(t.x,t.y,t.z,500);this.lat=n.lat,this.lon=n.lon,this.lon%=360,this.updateSandtable()}I(this,this.externalItem[this.nSceneIdx],e),I(this,this.globalSceneItem,e),I(this,this.scenePoints,e),this.vrMode&&Y(this,this.scenePoints)},l.prototype.getCurSceneInfo=function(){return{projectId:this.project.id,sceneId:this.nSceneIdx}},l.prototype.getSceneIndex=function(e){for(var t=this.project.scenes,n=0;n<t.length;n++)if(t[n].id===e)return n;return null},l.prototype.registerSceneItem=function(e,n,o,i){var r=[];if(void 0!==n&&null!==n){var s=this.getSceneIndex(n);if(null===s)return void console.log("registerSceneItem:invalid sceneId");s!==this.nSceneIdx&&$(e).hide(),void 0===this.externalItem[s]&&(this.externalItem[s]=[]),r=this.externalItem[s]}else n=null,r=this.globalSceneItem;if(null!=e.parentNode&&e.parentNode.id===this.containerId||$(e).appendTo($("#"+this.containerId)),void 0===o||null===o){var a=$(e).offset(),c=this.vec2ToVec3({x:a.left+$(e).width()/2,y:a.top+$(e).height()/2});o={x:c.x,y:c.y,z:c.z}}var l=new t(this,n,e,o,i);return r.push(l),l},l.prototype.batchRegisterItems=function(e){for(var t=[],n=0,o=e.length;n<o;++n){var i=this.registerSceneItem(e[n].elem,e[n].nId,e[n].pos,e[n].mode);t.push(i)}return t},l.prototype.unregisterSceneItem=function(e){var t=[];if(null!==e.nSceneId&&void 0!==e.nSceneId){var n=this.getSceneIndex(e.nSceneId);if(null===n&&console.log("registerSceneItem:invalid sceneId"),void 0===this.externalItem[n])return;t=this.externalItem[n]}else t=this.globalSceneItem;for(var o=0;o<t.length;o++)if(t[o]==e)return void t.splice(o,1)},l.prototype.addPointItem=function(e,n,o,i){if(null!=e.parentNode&&e.parentNode.id===this.containerId||$(e).appendTo($("#"+this.containerId)),!n){var r=$(e).offset(),s=this.vec2ToVec3({x:r.left,y:r.top});n={x:s.x,y:s.y,z:s.z}}var a=new t(this,this.getCurrScene().id,e,n,o);return i?$(e).addClass("vr-show"):this.vrMode&&$(e).addClass("vr-hide"),this.scenePoints.push(a),a},l.prototype.removePointItem=function(e){for(var t=0;t<this.scenePoints.length;t++)if(this.scenePoints[t]==e){this.scenePoints.splice(t,1);break}},l.prototype.getCurrScene=function(){return this.project.scenes[this.nSceneIdx]},l.prototype.clearCurrScene=function(){function e(e,n,o,i){e&&e.dispose(),n&&n.dispose(),o&&o.dispose(),i&&t.scene.remove(i)}var t=this;x(this.scenePoints),e(this.geometry,this.texture,this.material,this.mesh),e(this.bottom_geometry,this.bottom_texture,this.bottom_material,this.bottom_mesh),e(this.top_geometry,this.top_texture,this.top_material,this.top_mesh),e(this.bottom_logo_geometry,this.bottom_logo_texture,this.bottom_logo_material,this.bottom_logo_mesh),this.texture=null,this.geometry=null,this.material=null,this.mesh=null,this.scene=null,this.bottom_geometry=null,this.bottom_texture=null,this.bottom_material=null,this.bottom_mesh=null,this.top_geometry=null,this.top_texture=null,this.top_material=null,this.top_mesh=null,this.bottom_logo_geometry=null,this.bottom_logo_texture=null,this.bottom_logo_material=null,this.bottom_logo_mesh=null,this.renderer&&this.renderer.clear(),this.scenePoints=[],this.camera=null,null!==this.requestId&&cancelAnimationFrame(this.requestId),this.requestId=null,this.currScenePointMap={}},l.prototype.setSceneMap=function(e){for(var t={},n=0;n<e.sceneGroupList.length;n++){var o=e.sceneGroupList[n];if(o.sceneList)for(var i=0;i<o.sceneList.length;i++)o.sceneList[i].visual_angle={init_fov:90,init_point:{x:0,y:0,z:500},max_angle:89.9,max_fov:90,min_angle:-89.9,min_fov:40},t[o.sceneList[i].id]=o.sceneList[i]}return t},l.prototype.toSceneIdx=function(e){for(var t=b(this),n=e,o=0;o<t.length&&!(n<t[o].sceneList.length);o++)n-=t[o].sceneList.length;var i;if(o==t.length)for(var o=0;o<t.length;o++)t[o].sceneList.length>0&&(i=t[o].sceneList[0]);else i=t[o].sceneList[n];for(var r=o;r<t.length;r++)for(var o=0;o<t[r].sceneList.length;o++)if(t[r].sceneList[o].id==i)return o;for(var s=this.project.scenes,o=0;o<s.length;o++)if(s[o].id==i)return o;return 0},l.prototype.run=function(e){if(null===this.requestId){var t=0;"number"==typeof e&&e>=0&&e<this.project.scenes.length&&(t=e),this.loadScene(t);var n=this,o=function(){j(n,n.containerId),H(n),P(n),n.ready=!0,$(function(){$("audio").on("play",function(){$("audio").not(this).each(function(e,t){t.pause()})})})};this.project.enable_overlook?k(this,o):o()}},l.prototype.stop=function(){null===this.requestId&&cancelAnimationFrame(this.requestId)},l.prototype.getSceneIdlist=function(){if(!this.project||!this.project.scenes)return[];for(var e=[],t=this.project.scenes,n=0;n<t.length;n++)e.push(t[n].id);return e},l.prototype.setActiveScene=function(e){null===e&&console.log("setActiveScene error param");var t=this.getSceneIndex(e);this.nSceneIdx&&t==this.nSceneIdx||this.loadScene(t)},l.prototype.getActiveSceneId=function(){try{return this.project.scenes[this.nSceneIdx].id}catch(e){return null}},l.prototype.loadScene=function(e){y(this,this.nSceneIdx),this.nSceneIdx=e;var t=this.project.scenes[e];R(this,t.id),T(this,t),A(this.externalItem[e]),A(this.globalSceneItem),L(this,e),this.camera.updateProjectionMatrix(),z(this),this.updateSandPointView(),this.updateTitle();var n=this.getCurrScene().visual_angle;initVisualAngle(n);var o=n.init_point,i=a(o.x,o.y,o.z,500),i=a(0,0,500,500);this.init_lat=i.lat,this.init_lon=i.lon;for(var r=0;r<this.sceneChangeFunc.length;r++)this.sceneChangeFunc[r](t.id)},l.prototype.updateSandPointView=function(){if(this.spv=sandPointView(this.getCurrScene().id),$(".sand-table-view .sand-table-arrow").removeClass("current"),this.spv){for(var e=this.project.sand_table.points,t=0;t<e.length;t++)e[t].scene_id==this.getCurrScene().id&&(this.spv.init_degree=e[t].angle);this.spv.addClass("current"),this.spv.css("transform","rotate("+this.spv.init_degree+"deg)")}},l.prototype.updateTitle=function(){var e=this.getCurrScene().name;$(".corner-deck .span-name").text(e)};var B='<div class="corner-deck">     <div class="sand-table-view">         <img crossorigin ="Anonymous" id="sand-table-pic" class="left"/>     </div>     <ul>        <li class="music"></li>         <li class="sand-table off"></li>         <li class="device-orientation"></li>         <li class="auto-rotation off"></li>         <li class="vr-switch"></li>     </ul>       <audio autoplay class="bg_music_player"></audio>     </div>',N=function(e,t){var n=$("#"+e).css("position");"relateive"===n&&"absolute"===n||$("#"+e).css({position:"relative"});var o=new l(e);return o.AddLoadFilishEvent(loadAllPoint(o)),o.reloadProject(t),o};window.CreatePanorama=N,window.Panorama=l,window.xyz2latlon=a,window.latlon2xyz=s}();